{
"AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Capstone Project 2, simple DevOps enviromet",
    "Metadata": {

    },
    "Parameters": {
    
    },
    "Mappings": {

    },
    "Conditions": {

    },
    "Resources": {

        
        "JenkinsServer" : {
          "Type" : "AWS::EC2::SecurityGroup",
          "Properties" : {
            "GroupDescription" : "Provide Access to Jenkins Server",
            "SecurityGroupIngress" : { 
                "CidrIp" : "0.0.0.0/0",
                "Description" : "Make Jenkins Accessible on Port 8080",
                "FromPort" : 8080,
                "ToPort" : 8080,
                "IpProtocol" : "tcp"
            }
          }
        },
        "UbuntuEc2": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "KeyName": "erik-solutions-architect-oregon",
                "ImageId": "ami-0d1cd67c26f5fca19",
                "InstanceType": "t2.micro",
                "SecurityGroupIds" : [{ "Ref": "JenkinsServer" }],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -ex",
                                "wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add - \n",
                                "echo deb https://pkg.jenkins.io/debian-stable binary/ | sudo tee /etc/apt/sources.list.d/jenkins.list \n",
                                "sudo apt-get update \n",
                                "sudo apt-get install default-jre -y \n",
                                "sudo apt-get install jenkins -y \n",
                                "sudo systemctl start jenkins \n",
                                "sudo systemctl status jenkins \n",
                                "sudo ufw allow 8080 \n",
                                "sudo ufw allow OpenSSH \n",
                                "sudo ufw --force enable \n"
                            ]
                        ]
                    }
                }
        }
                }

    },
    "Outputs": {

    }
}